<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root { --dark-blue: #12193b; --row-bg: #1a2245; --cyan: #00f2ff; --logo-size: 30px; --name-width: 120px; --total-gap: 15px; }
        body { font-family: 'Oswald', sans-serif; margin: 0; background: #00FF00; overflow: hidden; width: 1920px; height: 1080px; }
        #board { position: absolute; left: 20px; bottom: 20px; background: var(--dark-blue); padding: 8px; border-radius: 4px; }
        .team-row { display: flex; align-items: center; height: 36px; background: var(--row-bg); margin-bottom: 2px; }
        .rank-col { width: 30px; text-align: center; font-weight: bold; color: white; }
        .logo-col { width: var(--logo-size); display: flex; justify-content: center; }
        .name-col { width: var(--name-width); padding-left: 10px; font-weight: bold; color: white; text-transform: uppercase; }
        .status-col { width: 60px; display: flex; justify-content: center; }
        .bar { width: 4px; height: 18px; background: var(--cyan); margin: 0 1px; }
        .bar.dead { opacity: 0.2; height: 5px; background: #445588; }
        .fin-col { width: 40px; text-align: center; font-weight: bold; color: white; }
        .total-box { background: var(--cyan); color: #000; height: 100%; width: 55px; display: flex; align-items: center; justify-content: center; font-weight: 900; margin-left: var(--total-gap); }
    </style>
</head>
<body>
    <div id="board"></div>
    <script>
        const firebaseConfig = { databaseURL: "https://bgmi-overlay-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        db.ref('liveData').on('value', (snap) => {
            const data = snap.val(); if(!data) return;
            const cfg = data.config || {};
            Object.entries(cfg).forEach(([p,v]) => { 
                let unit = (isNaN(v) || String(v).startsWith('#')) ? '' : 'px';
                document.documentElement.style.setProperty('--'+p, v + unit); 
            });
            render(data.teams || []);
        });

        function render(teams) {
            const sorted = [...teams].sort((a,b) => {
                let pA = (parseInt(a.fin)||0)+(parseInt(a.place)||0)+(a.matches?a.matches.reduce((x,y)=>x+parseInt(y),0):0);
                let pB = (parseInt(b.fin)||0)+(parseInt(b.place)||0)+(b.matches?b.matches.reduce((x,y)=>x+parseInt(y),0):0);
                return pB - pA;
            });

            let h = `<div style="display:flex; color:var(--cyan); font-size:10px; font-weight:bold; margin-bottom:5px;">
                        <div style="width:30px">#</div><div style="width:calc(var(--logo-size) + var(--name-width) + 10px)">TEAM</div>
                        <div style="width:60px; text-align:center">ALIVE</div><div style="width:40px">FIN</div><div style="margin-left:var(--total-gap)">TOT</div>
                    </div>`;
            
            sorted.forEach((t, i) => {
                let mPts = t.matches ? t.matches.reduce((a, b) => a + parseInt(b || 0), 0) : 0;
                let pts = (parseInt(t.fin)||0) + (parseInt(t.place)||0) + mPts;
                h += `<div class="team-row" style="opacity:${t.alive.every(a=>a==0)?0.4:1}">
                    <div class="rank-col">${i+1}</div>
                    <div class="logo-col"><img src="${t.logo}" style="width:var(--logo-size);height:var(--logo-size);object-fit:contain;"></div>
                    <div class="name-col">${t.name}</div>
                    <div class="status-col">${t.alive.map(a => `<div class="bar ${a?'':'dead'}"></div>`).join('')}</div>
                    <div class="fin-col">${t.fin}</div>
                    <div class="total-box">${pts}</div>
                </div>`;
            });
            document.getElementById('board').innerHTML = h;
        }
    </script>
</body>
</html>
