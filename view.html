<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --dark-blue: #12193b; --row-bg: #1a2245; --logo-name-bg: #242f66; --cyan: #00f2ff; --text-color: #ffffff; --row-h: 38px; --logo-size: 30px; --name-width: 120px; --col-gap: 5px; --total-gap: 15px; }
        body { font-family: 'Oswald', sans-serif; margin: 0; background: #00FF00; color: var(--text-color); overflow: hidden; }
        #board { position: absolute; left: 20px; bottom: 20px; background: var(--dark-blue); padding: 8px; border-radius: 8px; }
        .header-row { display: flex; font-size: 11px; font-weight: bold; color: var(--cyan); border-bottom: 1px solid rgba(0,242,255,0.3); margin-bottom: 8px; }
        .team-row { display: flex; align-items: center; height: var(--row-h); background: var(--row-bg); margin-bottom: 2px; }
        .team-row.eliminated { opacity: 0.3; filter: grayscale(1); }
        .logo-name-section { display: flex; align-items: center; background: var(--logo-name-bg); height: 100%; }
        .bar { width: 4px; height: 18px; background: white; margin: 0 1px; }
        .bar.dead { opacity: 0.2; height: 5px; background: #445588; }
        .total-box { background: var(--cyan); color: #000; height: 100%; display: flex; align-items: center; justify-content: center; font-weight: 900; }
        
        /* Elimination Popup */
        #elim-popup { position: fixed; top: -150px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; background: var(--dark-blue); border-radius: 8px; transition: top 0.6s ease; border: 1px solid var(--cyan); z-index: 1000; }
        #elim-popup.show { top: 30px; }
        
        /* Prediction */
        #prediction-panel { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); display: none; gap: 15px; z-index: 900; }
        #prediction-panel.show { display: flex; }
        .pred-card { background: var(--dark-blue); border: 2px solid var(--cyan); width: 140px; text-align: center; border-radius: 4px; overflow: hidden; }

        /* Winner Celebration */
        #winner-area { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; display: none; align-items: center; justify-content: center; z-index: 2000; background: rgba(0,0,0,0.85); }
        #winner-area.show { display: flex; flex-direction: column; }
    </style>
</head>
<body>
    <div id="elim-popup">
        <div style="width:80px;height:80px;"><img id="pop-logo" src="" style="width:100%;height:100%;object-fit:contain;"></div>
        <div style="padding:0 20px;"><p id="pop-name" style="font-size:24px;margin:0;"></p><p style="color:var(--cyan);margin:0;">ELIMINATED</p></div>
    </div>
    <div id="winner-area"><div id="win-logo-cont" style="width:400px;height:400px;"></div><h1 style="color:gold;font-size:60px;">CHAMPION</h1></div>
    <div id="prediction-panel"></div>
    <div id="board"></div>

    <script>
        const LIVE_URL = "https://bgmi-overlay-default-rtdb.firebaseio.com/liveData.json";
        let lastElimName = "";

        async function update() {
            try {
                const res = await fetch(LIVE_URL); const data = await res.json(); if(!data) return;
                
                // Config
                Object.entries(data.config || {}).forEach(([p,v]) => { document.documentElement.style.setProperty('--'+p, v+(isNaN(v)||v.startsWith('#')?'':'px')); });

                // Elimination Broadcast
                if (data.lastEliminated && data.lastEliminated.name !== lastElimName) {
                    lastElimName = data.lastEliminated.name;
                    document.getElementById('pop-logo').src = data.lastEliminated.logo;
                    document.getElementById('pop-name').innerText = data.lastEliminated.name;
                    const pop = document.getElementById('elim-popup');
                    pop.classList.add('show'); setTimeout(() => pop.classList.remove('show'), 6000);
                }

                const teams = data.teams || [];
                const sorted = [...teams].sort((a,b) => (parseInt(b.fin)+parseInt(b.place)+(b.matches?b.matches.reduce((x,y)=>x+parseInt(y),0):0)) - (parseInt(a.fin)+parseInt(a.place)+(a.matches?a.matches.reduce((x,y)=>x+parseInt(y),0):0)));
                const alive = sorted.filter(t => t.alive.some(a => a === 1));

                // Winner Logic
                if (alive.length === 1 && sorted.length > 1) {
                    document.getElementById('win-logo-cont').innerHTML = `<img src="${alive[0].logo}" style="width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 0 30px var(--cyan))">`;
                    document.getElementById('winner-area').classList.add('show'); return;
                } else { document.getElementById('winner-area').classList.remove('show'); }

                // Prediction Logic (2-5 Teams)
                const pPanel = document.getElementById('prediction-panel');
                if (alive.length >= 2 && alive.length <= 5) {
                    pPanel.classList.add('show'); document.getElementById('board').style.display = "none";
                    pPanel.innerHTML = "";
                    const totalS = alive.reduce((a,c) => a + (parseInt(c.fin)+c.alive.filter(x=>x).length*2.5), 0) || 1;
                    alive.forEach(t => {
                        const prob = (((parseInt(t.fin)+t.alive.filter(x=>x).length*2.5)/totalS)*100).toFixed(1);
                        pPanel.innerHTML += `<div class="pred-card"><div style="padding:5px;">${t.name}</div><div style="background:var(--cyan);color:000;font-size:20px;font-weight:bold;">${prob}%</div></div>`;
                    });
                } else {
                    pPanel.classList.remove('show'); document.getElementById('board').style.display = "block";
                    let h = `<div class="header-row"><div style="width:30px;text-align:center">#</div><div style="width:calc(var(--logo-size) + var(--name-width) + 15px)">TEAM</div><div style="width:55px;text-align:center;margin-left:var(--col-gap)">ALIVE</div><div style="width:40px;text-align:center">FIN</div><div style="width:60px;text-align:center;margin-left:var(--total-gap)">TOTAL</div></div>`;
                    sorted.forEach((t, i) => {
                        let tot = (parseInt(t.fin)+parseInt(t.place)+(t.matches?t.matches.reduce((x,y)=>x+parseInt(y),0):0));
                        h += `<div class="team-row ${t.alive.every(a=>a===0)?'eliminated':''}">
                            <div class="logo-name-section"><div style="width:30px;text-align:center">${i+1}</div><div style="width:var(--logo-size)"><img src="${t.logo}" style="width:100%" onerror="this.style.opacity='0'"></div><div style="width:var(--name-width);padding-left:10px">${t.name}</div></div>
                            <div style="width:55px;display:flex;justify-content:center;margin-left:var(--col-gap)">${t.alive.map(a => `<div class="bar ${a?'':'dead'}"></div>`).join('')}</div>
                            <div style="width:40px;text-align:center;font-weight:bold;">${t.fin}</div>
                            <div class="total-box" style="width:60px;margin-left:var(--total-gap)">${tot}</div>
                        </div>`;
                    });
                    document.getElementById('board').innerHTML = h;
                }
            } catch(e) {}
        }
        setInterval(update, 2000); update();
    </script>
</body>
</html>
