<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BGMI Studio v46.0 - View Panel</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/interactjs/dist/interact.min.js"></script>
    <style>
        :root {
            --rank-bg: #0e1236; --row-bg: rgba(255, 255, 255, 0.95); --text-dark: #000;
            --total-bg: #00e5ff; --accent: #ff9d00; --row-gap: 1px;
            --w-rank: 40px; --w-logo: 50px; --w-name: 200px; --w-status: 100px; --w-fin: 50px; --w-tot: 65px;
            --bar-w: 4px; --bar-h: 18px; --bar-g: 3px; --fade: 1;
        }
        body { margin: 0; width: 1920px; height: 1080px; background: #00ff00; font-family: 'Bahnschrift', sans-serif; overflow: hidden; }

        .movable { position: absolute; touch-action: none; cursor: move; }
        
        /* FORECAST PANEL */
        #forecast-box { display: none; gap: 10px; top: 30px; left: 50%; transform: translateX(-50%); }
        .f-item { width: 180px; height: 75px; background: var(--accent); border-left: 25px solid #111; display: flex; flex-direction: column; justify-content: center; padding-left: 10px; color: #000; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        /* LEADERBOARD */
        #board { right: 50px; top: 150px; display: table; border-collapse: separate; border-spacing: 0 var(--row-gap); }
        .lb-row { display: flex; background: var(--row-bg); height: 35px; align-items: center; color: var(--text-dark); font-weight: 900; opacity: var(--fade); animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        .col-rank { width: var(--w-rank); background: var(--rank-bg); color: white; height: 100%; display: flex; align-items: center; justify-content: center; }
        .col-logo { width: var(--w-logo); text-align: center; display: flex; align-items: center; justify-content: center; background: #fff; height: 100%; }
        .col-logo img { height: 26px; width: 26px; object-fit: contain; }
        .col-name { width: var(--w-name); padding-left: 10px; text-transform: uppercase; font-size: 14px; white-space: nowrap; overflow: hidden; }
        .col-status { width: var(--w-status); display: flex; gap: var(--bar-g); justify-content: center; align-items: center; }
        .col-fin { width: var(--w-fin); text-align: center; border-left: 1px solid #ccc; height: 100%; display: flex; align-items: center; justify-content: center; }
        .col-tot { width: var(--w-tot); background: var(--total-bg); color: #000; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        
        .v-bar { width: var(--bar-w); height: var(--bar-h); background: #0e1236; }
        .v-bar.dead { background: #cbd5e0; opacity: 0.3; }

        /* ELIMINATION POPUP */
        #alert { width: 380px; height: 95px; background: #230808; border-bottom: 4px solid var(--accent); display: none; z-index: 10000; overflow: hidden; top: 100px; left: 50%; transform: translateX(-50%); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .alert-tag { position: absolute; top: 0; left: 0; background: var(--accent); color: #000; padding: 2px 10px; font-size: 10px; font-weight: 900; clip-path: polygon(0 0, 100% 0, 85% 100%, 0% 100%); }
    </style>
</head>
<body>

<div id="forecast-box" class="movable"></div>

<div id="board" class="movable">
    <div id="board-rows"></div>
</div>

<div id="alert">
    <div class="alert-tag">ELIMINATED</div>
    <div style="display:flex; height:100%;">
        <div style="width:95px; background:#300; display:flex; align-items:center; justify-content:center;"><img id="a-img" src="" style="width:65px;"></div>
        <div style="flex:1; background:#000; padding:15px; color:white; border-left: 2px solid #444;">
            <div id="a-name" style="font-size:22px; font-weight:900; text-transform:uppercase;">TEAM NAME</div>
            <div style="display:flex; gap:20px; margin-top:5px; border-top:1px solid #333; padding-top:5px;">
                <div style="font-size:12px;">RANK <span style="color:var(--accent); font-size:24px; font-weight:900;" id="a-rank">#0</span></div>
                <div style="font-size:12px;">ELIMS <span style="color:var(--accent); font-size:24px; font-weight:900;" id="a-fin">0</span></div>
            </div>
        </div>
    </div>
</div>

<script>
    // Firebase Config (Must match Admin)
    const firebaseConfig = { databaseURL: "https://live-pt-67ab3-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Draggable View Components (OBS set karne ke liye)
    interact('.movable').draggable({
        listeners: { move (e) {
            let t = e.target;
            let x = (parseFloat(t.dataset.x) || 0) + e.dx;
            let y = (parseFloat(t.dataset.y) || 0) + e.dy;
            t.style.transform = `translate(${x}px, ${y}px)`;
            t.dataset.x = x; t.dataset.y = y;
        }}
    });

    // Real-time Settings Sync
    db.ref('settings').on('value', snap => {
        const s = snap.val();
        for(let k in s) document.documentElement.style.setProperty('--'+k, s[k]);
    });

    // Real-time Team Data
    db.ref('teams').on('value', snap => {
        const teams = Object.values(snap.val() || {});
        render(teams);
        updateForecast(teams);
    });

    function render(teams) {
        const rows = document.getElementById('board-rows');
        rows.innerHTML = '';
        let sorted = [...teams].sort((a,b) => (b.kills + b.place) - (a.kills + a.place));

        sorted.forEach((t, i) => {
            let bars = '';
            for(let j=1; j<=4; j++) bars += `<div class="v-bar ${j<=t.alive?'':'dead'}"></div>`;
            rows.innerHTML += `
                <div class="lb-row" style="${t.dead?'opacity:0.4; filter:grayscale(1)':''}">
                    <div class="col-rank">${i+1}</div>
                    <div class="col-logo"><img src="${t.logo}"></div>
                    <div class="col-name">${t.name}</div>
                    <div class="col-status">${bars}</div>
                    <div class="col-fin">${t.kills}</div>
                    <div class="col-tot">${t.kills + t.place}</div>
                </div>`;
        });
    }

    function updateForecast(teams) {
        const f = document.getElementById('forecast-box');
        const alive = teams.filter(t => !t.dead);
        if(alive.length > 0 && alive.length <= 5) {
            f.style.display = 'flex'; f.innerHTML = '';
            const totalAliveKills = alive.reduce((acc, t) => acc + t.kills, 0) || 1;
            alive.sort((a,b) => b.kills - a.kills).forEach(t => {
                let prob = Math.round((t.kills / totalAliveKills) * 100);
                f.innerHTML += `<div class="f-item">
                    <div style="font-size:11px; font-weight:900; opacity:0.8;">WIN CHANCE</div>
                    <div style="font-size:12px; font-weight:900; overflow:hidden;">${t.name}</div>
                    <div style="font-size:22px; font-weight:900;">${prob}%</div>
                </div>`;
            });
        } else { f.style.display = 'none'; }
    }

    // Elimination Event Listener
    db.ref('lastElim').on('value', snap => {
        const d = snap.val();
        if(!d) return;
        const a = document.getElementById('alert');
        document.getElementById('a-img').src = d.logo;
        document.getElementById('a-name').innerText = d.name;
        document.getElementById('a-rank').innerText = "#" + d.rank;
        document.getElementById('a-fin').innerText = d.kills;
        a.style.display = 'block';
        setTimeout(() => a.style.display = 'none', 6000);
    });
</script>
</body>
</html>
