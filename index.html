<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sanjay BGMI Ultra Dashboard</title>
    <style>
        :root { --orange:#ff5a00; --blue:#0088ff; --green:#2ecc71; --red:#dc3545; --dark:#111; }
        body { margin:0; font-family:'Oswald', sans-serif; background:#050505; color:#fff; overflow:hidden; }
        #admin { display: grid; grid-template-columns: 1fr 400px; height: 100vh; }
        
        /* Left Panel: Control Grid */
        .control-panel { padding: 20px; overflow-y: auto; border-right: 2px solid #333; }
        .grid-25 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .slot-card { 
            background: #1a1a1a; border: 2px solid #333; border-radius: 8px; padding: 10px; 
            text-align: center; cursor: pointer; position: relative;
        }
        .slot-card.active { border-color: var(--green); box-shadow: 0 0 10px var(--green); }
        .slot-card h2 { margin: 0; font-size: 28px; }
        
        /* Right Panel: Settings */
        .settings-panel { padding: 15px; background: #0a0a0a; overflow-y: auto; }
        .section-title { color: var(--orange); border-bottom: 1px solid var(--orange); margin: 15px 0 10px; padding-bottom: 5px; text-transform: uppercase; font-size: 14px; }
        
        input, select, textarea { width: 100%; background: #000; color: #fff; border: 1px solid #444; padding: 8px; margin-bottom: 8px; border-radius: 4px; box-sizing: border-box; }
        .btn { width: 100%; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        
        /* Mini Stats */
        .stats-row { display: flex; gap: 5px; margin-top: 5px; }
        .stats-row input { font-size: 10px; padding: 4px; }
        
        /* Hidden UI */
        .hide-ui { display: none !important; }
    </style>
</head>
<body>

<div id="admin">
    <div class="control-panel">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="color: var(--orange); margin: 0;">PRO BROADCAST GRID</h2>
            <div style="display: flex; gap: 10px;">
                <button class="btn" style="background: var(--blue); width: auto;" onclick="window.open('overlay.html')">OPEN OVERLAY</button>
                <button class="btn" style="background: var(--red); width: auto;" onclick="toggleSettings()">CAST MODE</button>
            </div>
        </div>

        <div class="grid-25" id="mainGrid"></div>
        
        <div class="section-title">SPECIAL CARDS (MVP / WWCD)</div>
        <div style="display: flex; gap: 10px;">
            <button class="btn" style="background: gold; color: #000;" onclick="triggerCard('WWCD')">üèÜ SHOW WWCD</button>
            <button class="btn" style="background: #fff; color: #000;" onclick="triggerCard('MVP')">üåü SHOW MVP</button>
        </div>
    </div>

    <div class="settings-panel" id="sideSettings">
        <div class="section-title">MATCH INFO</div>
        <input type="text" id="mNum" placeholder="Match Number (e.g. Match 01)" onchange="syncMeta()">
        <input type="text" id="mMap" placeholder="Map Name (e.g. Erangel)" onchange="syncMeta()">

        <div class="section-title">BULK TEAM IMPORT</div>
        <textarea id="bulkArea" placeholder="1 | TEAM NAME"></textarea>
        <button class="btn" style="background: #333;" onclick="importTeams()">IMPORT LIST</button>

        <div class="section-title">SOCIAL & SPONSORS (ROTATION)</div>
        <input type="text" id="soc1" placeholder="Social 1: Caster Indian" onchange="syncMeta()">
        <input type="text" id="soc2" placeholder="Social 2: Onyx is Live" onchange="syncMeta()">

        <div class="section-title">POINTS TABLE (AUTO CALC)</div>
        <button class="btn" style="background: var(--green);" onclick="generatePointsTable()">GENERATE STANDINGS</button>
        
        <div id="teamConfigs"></div>
    </div>
</div>

<script>
    const CONFIG_URL = "https://bgmi-overlay-default-rtdb.firebaseio.com/configData.json";
    const LIVE_URL = "https://bgmi-overlay-default-rtdb.firebaseio.com/liveData.json";

    const fixedColors = { 1: '#10449e', 2: '#1b5e20', 3: '#c62828', 4: '#e65100', 5: '#6a1b9a', 6: '#2ecc71', 7: '#ad1457', 8: '#00796b', 9: '#795548', 10: '#303f9f', 11: '#fbc02d', 12: '#1565c0', 13: '#388e3c', 14: '#ff8f00', 15: '#d81b60', 16: '#7b1fa2', 17: '#00897b', 18: '#9e9e9e', 19: '#558b2f', 20: '#5d4037', 21: '#0277bd', 22: '#616161', 23: '#ff5722', 24: '#7cb342', 25: '#263238' };

    let teamDB = JSON.parse(localStorage.getItem('sanjay_db') || '{}');
    let meta = { mNum: "Match 1", mMap: "Erangel", soc1: "Caster Indian", soc2: "Onyx is Live" };

    function init() {
        const grid = document.getElementById('mainGrid');
        const configs = document.getElementById('teamConfigs');
        grid.innerHTML = ""; configs.innerHTML = "";

        for(let i=1; i<=25; i++) {
            if(!teamDB[i]) teamDB[i] = { name: `TEAM ${i}`, finishes: 0, alive: 4, placement: 0 };
            const t = teamDB[i];

            // Dashboard Card
            grid.innerHTML += `
                <div class="slot-card" id="slot-${i}" onclick="sendToLive(${i})" style="border-bottom: 4px solid ${fixedColors[i]}">
                    <h2>${i}</h2>
                    <p style="font-size:10px;">${t.name}</p>
                    <div style="font-size:12px; color:var(--green)">F: ${t.finishes} | A: ${t.alive}</div>
                </div>`;

            // Config Form
            configs.innerHTML += `
                <div style="background:#1a1a1a; padding:10px; border-radius:5px; margin-bottom:10px;">
                    <div style="font-weight:bold; color:var(--orange)">SLOT ${i}</div>
                    <input type="text" value="${t.name}" onchange="updateTeam(${i}, 'name', this.value)" placeholder="Team Name">
                    <div class="stats-row">
                        <input type="number" value="${t.finishes}" onchange="updateTeam(${i}, 'finishes', this.value)" placeholder="Finishes">
                        <input type="number" value="${t.alive}" onchange="updateTeam(${i}, 'alive', this.value)" placeholder="Alive">
                    </div>
                </div>`;
        }
    }

    function updateTeam(i, key, val) {
        teamDB[i][key] = (key === 'name') ? val : parseInt(val);
        localStorage.setItem('sanjay_db', JSON.stringify(teamDB));
        init();
    }

    function syncMeta() {
        meta.mNum = document.getElementById('mNum').value;
        meta.mMap = document.getElementById('mMap').value;
        meta.soc1 = document.getElementById('soc1').value;
        meta.soc2 = document.getElementById('soc2').value;
    }

    function sendToLive(i) {
        const t = teamDB[i];
        const payload = { 
            type: 'TEAM_VIEW', slot: i, name: t.name, finishes: t.finishes, 
            alive: t.alive, color: fixedColors[i], meta: meta, ts: Date.now() 
        };
        fetch(LIVE_URL, { method: "PUT", body: JSON.stringify(payload) });
        document.querySelectorAll('.slot-card').forEach(c => c.classList.remove('active'));
        document.getElementById(`slot-${i}`).classList.add('active');
    }

    function triggerCard(cardType) {
        const payload = { type: cardType, meta: meta, ts: Date.now() };
        fetch(LIVE_URL, { method: "PUT", body: JSON.stringify(payload) });
    }

    function toggleSettings() {
        document.getElementById('sideSettings').classList.toggle('hide-ui');
    }

    function importTeams() {
        const text = document.getElementById('bulkArea').value;
        text.split('\n').forEach(line => {
            const m = line.match(/(\d+)\s*[|‚Ä¢-]\s*(.+)/);
            if(m) {
                const s = parseInt(m[1]);
                if(s>=1 && s<=25) teamDB[s].name = m[2].trim();
            }
        });
        init();
    }

    init();
</script>
</body>
</html>
