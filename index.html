<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Caster Indian - Pro Firebase Admin</title>
    <style>
        :root { --cyan: #00f2ff; }
        body { font-family: 'Oswald', sans-serif; background: #111; color: white; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .admin-panel { background: #1a1a1a; padding: 20px; border-radius: 8px; width: 850px; border: 1px solid #444; height: 95vh; overflow-y: auto; }
        .setting-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #222; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid var(--cyan); }
        .item { display: flex; align-items: center; justify-content: space-between; background: #333; padding: 5px 10px; border-radius: 4px; }
        .team-card { background: #2a2a2a; padding: 15px; margin-bottom: 15px; border-radius: 6px; border: 1px solid #333; position: relative; }
        .edit-grid { display: grid; grid-template-columns: 150px 1fr 100px; gap: 10px; margin-bottom: 10px; }
        .matches-area { display: flex; flex-wrap: wrap; gap: 8px; margin: 10px 0; padding: 10px; background: #111; border-radius: 4px; }
        .match-input { width: 60px !important; text-align: center; background: #333 !important; }
        input { background: #444; border: 1px solid #666; color: white; padding: 8px; border-radius: 4px; font-size: 12px; width: 100%; }
        input[type="color"] { border: none; width: 30px; height: 30px; cursor: pointer; background: transparent; }
        .p-btn { width: 35px; height: 35px; border: none; background: var(--cyan); font-weight: bold; cursor: pointer; border-radius: 4px; margin-right: 5px; }
        .p-btn.off { background: #555; opacity: 0.4; }
        .action-btn { width: 100%; padding: 15px; margin-bottom: 15px; border: none; cursor: pointer; font-weight: bold; border-radius: 6px; text-transform: uppercase; }
        label { font-size: 9px; color: #aaa; font-weight: bold; text-transform: uppercase; display: block; margin-bottom: 3px; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="admin-panel">
        <h2 style="color:var(--cyan); text-align:center; margin-bottom:20px;">BGMI PRO FIREBASE ADMIN</h2>
        <div class="setting-grid">
            <div class="item"><label>Board BG</label> <input type="color" oninput="updateCfg('dark-blue', this.value)"></div>
            <div class="item"><label>Row BG Color</label> <input type="color" oninput="updateCfg('row-bg', this.value)"></div>
            <div class="item"><label>Logo/Name BG</label> <input type="color" oninput="updateCfg('logo-name-bg', this.value)"></div>
            <div class="item"><label>Cyan Color</label> <input type="color" oninput="updateCfg('cyan', this.value)"></div>
            <div class="item"><label>Text Color</label> <input type="color" oninput="updateCfg('text-color', this.value)"></div>
            <div class="item"><label>Logo Size</label> <input type="range" min="20" max="80" oninput="updateCfg('logo-size', this.value)"></div>
            <div class="item"><label>Name Width</label> <input type="range" min="50" max="350" oninput="updateCfg('name-width', this.value)"></div>
            <div class="item"><label>Col Gap</label> <input type="range" min="0" max="50" oninput="updateCfg('col-gap', this.value)"></div>
            <div class="item"><label>Total Gap</label> <input type="range" min="0" max="100" oninput="updateCfg('total-gap', this.value)"></div>
        </div>
        <button class="action-btn" style="background:#28a745; color:white;" onclick="addTeam()">+ ADD TEAM</button>
        <div id="team-list"></div>
    </div>
    <script>
        const LIVE_URL = "https://bgmi-overlay-default-rtdb.firebaseio.com/liveData.json";
        let teams = []; let config = {};

        async function sync() { await fetch(LIVE_URL, { method: 'PUT', body: JSON.stringify({ teams, config }) }); }
        function updateCfg(p, v) { config[p] = v; sync(); }
        
        function draw() {
            const list = document.getElementById('team-list'); list.innerHTML = '';
            teams.forEach((t, i) => {
                // MATCH CALCULATION: Matches array ke points ka sum
                let matchPoints = t.matches ? t.matches.reduce((a, b) => a + parseInt(b || 0), 0) : 0;
                t.total = parseInt(t.fin || 0) + parseInt(t.place || 0) + matchPoints;
                
                list.innerHTML += `<div class="team-card">
                    <div class="edit-grid">
                        <div><label>Team Name</label><input value="${t.name}" onchange="edit(${i},'name',this.value)"></div>
                        <div><label>Logo URL</label><input value="${t.logo}" onchange="edit(${i},'logo',this.value)"></div>
                        <div><label>Grand Total</label><input value="${t.total}" readonly style="background:#111; color:var(--cyan); font-weight:bold;"></div>
                    </div>
                    <div style="display:flex; gap:20px; align-items:center;">
                        <div><label>Live Finishes</label><input type="number" value="${t.fin}" onchange="edit(${i},'fin',this.value)" style="width:80px"></div>
                        <div><label>Live Placement</label><input type="number" value="${t.place}" onchange="edit(${i},'place',this.value)" style="width:80px"></div>
                        <div style="flex:1">
                            <label>MATCH POINTS (ADD MATCH OPTION)</label>
                            <div class="matches-area" id="m-area-${i}">
                                ${(t.matches || []).map((m, mi) => `<input type="number" class="match-input" value="${m}" onchange="updateMatch(${i},${mi},this.value)">`).join('')}
                                <button onclick="addMatch(${i})" style="padding:5px 10px; cursor:pointer; background:var(--cyan); border:none; font-weight:bold;">+ ADD MATCH</button>
                            </div>
                        </div>
                    </div>
                    <div style="display:flex; justify-content:space-between; margin-top:10px;">
                        <div style="display:flex;">${t.alive.map((a,pi)=>`<button class="p-btn ${a?'':'off'}" onclick="tog(${i},${pi})">${pi+1}</button>`).join('')}</div>
                        <button style="background:#ff4444; color:white; border:none; padding:5px 10px; cursor:pointer;" onclick="removeTeam(${i})">DEL TEAM</button>
                    </div>
                </div>`;
            });
        }
        function updateMatch(ti, mi, v) { teams[ti].matches[mi] = v; sync(); draw(); }
        function addMatch(ti) { if(!teams[ti].matches) teams[ti].matches = []; teams[ti].matches.push(0); sync(); draw(); }
        function edit(i, f, v) { teams[i][f] = v; sync(); draw(); }
        function tog(i, pi) { teams[i].alive[pi] = teams[i].alive[pi] ? 0 : 1; sync(); draw(); }
        function addTeam() { teams.push({ name: "NEW", logo: "", fin: 0, place: 0, matches: [], alive: [1,1,1,1] }); sync(); draw(); }
        function removeTeam(i) { teams.splice(i, 1); sync(); draw(); }
        async function init() { const res = await fetch(LIVE_URL); const data = await res.json(); if(data) { teams = data.teams || []; config = data.config || {}; draw(); } }
        init();
    </script>
</body>
</html>
