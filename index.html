<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BGMI Studio v44.0 - Admin PNG Edition</title>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        :root { --accent: #00e5ff; }

        body{
            margin:0;
            background:#111;
            font-family:'Bahnschrift',sans-serif;
            color:#fff;
            padding-left:330px;           /* admin left panel width */
            overflow:hidden;
        }

        /* ------------ LEFT ADMIN PANEL ------------ */
        #admin{
            width:310px;
            height:100vh;
            background:#111;
            position:fixed;
            left:0;
            top:0;
            padding:15px;
            border-right:2px solid #333;
            overflow-y:auto;
            font-size:11px;
            z-index:1000;
        }
        .config-sec{
            background:#1a1a1a;
            padding:10px;
            margin-bottom:12px;
            border-radius:4px;
            border-top:2px solid var(--accent);
        }
        .config-sec h4{
            margin:0 0 8px 0;
            color:var(--accent);
            text-transform:uppercase;
            font-size:10px;
        }
        label{display:block;margin-top:5px;color:#888;}
        input[type="range"],input[type="text"]{
            width:100%;
            accent-color:var(--accent);
            background:#000;
            color:#fff;
            border:1px solid #444;
        }
        .btn-main{
            background:var(--accent);
            color:#000;
            width:100%;
            padding:10px;
            border:none;
            font-weight:900;
            cursor:pointer;
            border-radius:4px;
            text-transform:uppercase;
            margin-bottom:5px;
        }
        .team-ctrl{
            background:#222;
            padding:5px;
            margin-bottom:4px;
            display:flex;
            gap:5px;
            align-items:center;
            border-radius:3px;
        }
        input[type="number"]{
            background:#000;
            color:#fff;
            border:1px solid #444;
            width:35px;
        }

        /* ------------ MODAL FOR TEAM SETUP ------------ */
        #modal{
            position:fixed;
            top:5%;
            left:340px;
            right:20px;
            height:85%;
            background:#111;
            padding:20px;
            border:1px solid var(--accent);
            display:none;
            z-index:1001;
            color:#fff;
            overflow-y:auto;
        }

        /* ========== OVERLAY DESIGN PART ========== */

        /* Bg PNG (optional from settings/bg-url) */
        #bg-image{
            position:fixed;
            inset:0;
            background-position:center;
            background-size:contain;
            background-repeat:no-repeat;
            pointer-events:none;
            opacity:1;
        }

        /* TOP STRIPS ‚Äì optional (can be extended later) */
        .top-bar{
            position:absolute;
            top:20px;
            left:50%;
            transform:translateX(-50%);
            display:flex;
            gap:40px;
            z-index:10;
        }
        .team-strip-wrap.dead .team-strip{filter:grayscale(1);opacity:0.4;}
        .team-strip{
            width:240px;
            height:72px;
            display:flex;
            background:#f8a93a;
            box-shadow:0 0 10px rgba(0,0,0,0.6);
            font-size:14px;
            text-transform:uppercase;
        }
        .team-strip-logo{
            width:70px;
            background:#2a0c0e;
            display:flex;
            align-items:center;
            justify-content:center;
            color:#fff;
            font-weight:bold;
        }
        .team-strip-body{
            flex:1;
            padding:6px 10px;
            display:flex;
            flex-direction:column;
            justify-content:space-between;
        }
        .team-strip-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            font-weight:bold;
        }
        .team-strip-header span.small{font-size:12px;}
        .team-strip-footer{
            display:flex;
            align-items:center;
            gap:6px;
        }
        .life-bars{display:flex;gap:3px;}
        .life-bar{width:8px;height:18px;background:#2a0c0e;}
        .kills-box{
            margin-left:auto;
            font-weight:bold;
            color:#2a0c0e;
            font-size:16px;
        }

        /* ------------ TEAM ELIMINATION POPUP ------------ */
        .elim-popup{
            position:absolute;
            top:80px;
            left:50%;
            transform:translateX(-50%);
            width:540px;
            height:120px;
            display:none;
            grid-template-columns:140px 1fr;
            background:#2a0c0e;
            box-shadow:0 0 25px rgba(0,0,0,0.8);
            overflow:hidden;
            z-index:20;
        }
        .elim-left{
            background:#2a0c0e;
            display:flex;
            align-items:center;
            justify-content:center;
            flex-direction:column;
            color:#f8a93a;
            font-weight:bold;
        }
        .elim-left .logo{
            width:70px;
            height:70px;
            border-radius:50%;
            border:3px solid #f8a93a;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:18px;
            background-size:cover;
            background-position:center;
        }
        .elim-right{
            background:#3a1013;
            padding:10px 18px;
            display:flex;
            flex-direction:column;
            justify-content:space-between;
            position:relative;
        }
        .elim-tag{
            position:absolute;
            top:0;
            left:0;
            background:#f8a93a;
            color:#2a0c0e;
            padding:4px 14px;
            font-weight:bold;
            font-size:14px;
        }
        .elim-team-name{
            margin-top:22px;
            font-size:22px;
            font-weight:bold;
        }
        .elim-stats{
            margin-top:6px;
            display:flex;
            gap:25px;
            font-size:14px;
            text-transform:uppercase;
        }
        .elim-stats span.label{
            color:#f8a93a;
            font-weight:bold;
            margin-right:6px;
        }

        /* ------------ RIGHT ALIVE TABLE + FORECAST ------------ */
        .right-panel{
            position:absolute;
            top:90px;
            right:40px;
            width:260px;
            background:#2a0c0e;
            box-shadow:0 0 18px rgba(0,0,0,0.7);
            font-size:13px;
            text-transform:uppercase;
            z-index:10;
        }
        .table-header,.table-row{
            display:grid;
            grid-template-columns:26px 1fr 60px 32px;
            align-items:center;
            height:26px;
        }
        .table-header{
            background:#4a1518;
            font-weight:bold;
            font-size:11px;
        }
        .table-header div{padding:0 6px;}
        .table-body{max-height:360px;overflow:hidden;}
        .table-row{background:#7b2224;color:#fff;}
        .table-row:nth-child(2n){background:#6a1c1f;}
        .cell{padding:0 6px;}
        .status-bars{display:flex;gap:2px;}
        .status-bar{width:5px;height:16px;background:#f8a93a;}
        .row-dead{opacity:0.45;}

        .legend{
            display:flex;
            justify-content:flex-end;
            gap:12px;
            padding:6px 8px;
            background:#2a0c0e;
            font-size:11px;
        }
        .box-alive,.box-dead{
            width:10px;
            height:10px;
            display:inline-block;
            margin-right:4px;
        }
        .box-alive{background:#7b2224;}
        .box-dead{background:#f8a93a;}

        .forecast{
            margin-top:4px;
            border-top:2px solid #f8a93a;
            padding:6px 8px 8px;
            background:#3a1013;
            font-size:11px;
        }
        .forecast-title{
            font-weight:bold;
            margin-bottom:4px;
            color:#f8a93a;
        }
        .forecast-row{
            display:flex;
            justify-content:space-between;
            margin:1px 0;
        }
    </style>
</head>
<body>

<!-- BG PNG -->
<div id="bg-image"></div>

<!-- LEFT ADMIN PANEL -->
<div id="admin">
    <button class="btn-main" onclick="toggleM()">‚öôÔ∏è SETUP TEAMS</button>

    <div class="config-sec">
        <h4>üñºÔ∏è Background PNG Overlay</h4>
        <label>PNG Image URL</label>
        <input type="text" id="bg-url" placeholder="Paste PNG link here" onchange="adj('bg-url', this.value)">
    </div>

    <div class="config-sec">
        <h4>üé® Design Controls</h4>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
            <div>Row <input type="color" value="#7b2224" oninput="adj('row-bg', this.value)"></div>
            <div>Total <input type="color" value="#f8a93a" oninput="adj('total-bg', this.value)"></div>
            <div>Rank <input type="color" value="#4a1518" oninput="adj('rank-bg', this.value)"></div>
        </div>
        <label>Elim Fade</label>
        <input type="range" min="0" max="100" value="40" oninput="adj('fade-op', this.value/100)">
    </div>

    <div class="config-sec">
        <h4>‚ÜîÔ∏è Row & Bar Adjust</h4>
        <label>Row Gap</label><input type="range" min="0" max="25" value="2" oninput="adj('row-gap', this.value+'px')">
        <label>Bar Width</label><input type="range" min="1" max="10" value="3" oninput="adj('bar-w', this.value+'px')">
        <label>Bar Height</label><input type="range" min="5" max="30" value="16" oninput="adj('bar-h', this.value+'px')">
    </div>

    <div class="config-sec">
        <h4>üìè Column Widths</h4>
        <label>Name Box</label><input type="range" min="50" max="500" value="200" oninput="adj('w-name', this.value+'px')">
        <label>Status Box</label><input type="range" min="20" max="200" value="100" oninput="adj('w-status', this.value+'px')">
    </div>

    <div id="ctrl-list"></div>
</div>

<!-- TEAM SETUP MODAL -->
<div id="modal">
    <h3>Team Data Entry</h3>
    <div id="set-inputs"></div>
    <button onclick="addT()" style="background:green; color:white; border:none; padding:10px; cursor:pointer;">+ ADD NEW TEAM</button>
    <button onclick="saveS()" class="btn-main" style="margin-top:20px;">SAVE ALL</button>
</div>

<!-- ELIMINATION POPUP -->
<div class="elim-popup" id="elimPopup">
    <div class="elim-left">
        <div class="logo" id="elimLogo"></div>
    </div>
    <div class="elim-right">
        <div class="elim-tag">ELIMINATED</div>
        <div class="elim-team-name" id="elimName">TEAM NAME</div>
        <div class="elim-stats">
            <div><span class="label">Rank</span><span id="elimRank">#1</span></div>
            <div><span class="label">Elims</span><span id="elimElims">02</span></div>
        </div>
    </div>
</div>

<!-- RIGHT SIDE TABLE + FORECAST -->
<div class="right-panel">
    <div class="table-header">
        <div class="cell">#</div>
        <div class="cell">Team</div>
        <div class="cell">Status</div>
        <div class="cell">Fin</div>
    </div>
    <div class="table-body" id="tableBody"></div>

    <div class="legend">
        <span><span class="box-alive"></span>Alive</span>
        <span><span class="box-dead"></span>Eliminated</span>
    </div>

    <div class="forecast" id="forecastBox">
        <div class="forecast-title">Forecast ‚Äì Win %</div>
        <div id="forecastRows"></div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://live-pt-67ab3-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const posPoints = {1:10,2:6,3:5,4:4,5:3,6:2,7:1,8:1};

    function adj(p,v){ db.ref('settings/'+p).set(v); }

    /* ---------- SETTINGS LISTENER (for bg PNG etc.) ---------- */
    db.ref('settings').on('value',snap=>{
        const s = snap.val() || {};
        if(s['bg-url']){
            document.getElementById('bg-image').style.backgroundImage = 'url('+s['bg-url']+')';
        }
    });

    /* ---------- TEAM CONTROL LIST (LEFT PANEL) ---------- */
    db.ref('teams').on('value',snap=>{
        const teams = snap.val() || [];
        const ctrl = document.getElementById('ctrl-list');
        ctrl.innerHTML='';
        teams.forEach((t,i)=>{
            ctrl.innerHTML += `
            <div class="team-ctrl">
                <b style="flex:1;">${t.name}</b>
                K:<input type="number" value="${t.kills||0}" onchange="db.ref('teams/${i}/kills').set(parseInt(this.value)||0)">
                A:<input type="number" min="0" max="4" value="${t.alive||0}" onchange="db.ref('teams/${i}/alive').set(parseInt(this.value)||0)">
                <input type="checkbox" ${t.dead?'checked':''} onchange="triggerElim(${i}, this.checked)">
            </div>`;
        });
        renderOverlay(teams);
    });

    /* ---------- ELIMINATION LOGIC + POPUP TRIGGER ---------- */
    function triggerElim(i,isChecked){
        db.ref('teams').once('value',snap=>{
            let list = snap.val() || [];
            if(isChecked){
                let aliveNow = list.filter(t=>!t.dead).length;
                list[i].autoPlace = posPoints[aliveNow] || 0;
                list[i].dead = true;
                list[i].alive = 0;
                db.ref('lastElim').set({
                    name:list[i].name,
                    logo:list[i].logo,
                    kills:list[i].kills||0,
                    rank:aliveNow,
                    time:Date.now()
                });
            }else{
                list[i].dead = false;
                list[i].autoPlace = 0;
                list[i].alive = 4;
            }
            db.ref('teams').set(list);
        });
    }

    /* Listen for lastElim to show popup */
    let lastShownTime = 0;
    db.ref('lastElim').on('value',snap=>{
        const d = snap.val();
        if(!d || !d.time || d.time === lastShownTime) return;
        lastShownTime = d.time;
        const p = document.getElementById('elimPopup');
        document.getElementById('elimName').innerText = d.name || 'TEAM';
        document.getElementById('elimRank').innerText = '#'+(d.rank || 0);
        document.getElementById('elimElims').innerText = ('0'+(d.kills||0)).slice(-2);
        const logoDiv = document.getElementById('elimLogo');
        logoDiv.style.backgroundImage = 'url('+(d.logo || 'https://i.ibb.co/VWVx67n/default.png')+')';
        p.style.display='grid';
        setTimeout(()=>{p.style.display='none';},3000);
    });

    /* ---------- MODAL TEAM EDIT ---------- */
    function toggleM(){
        const m=document.getElementById('modal');
        m.style.display=(m.style.display==='block')?'none':'block';
        if(m.style.display==='block'){
            db.ref('teams').once('value',snap=>{
                const teams=snap.val()||[];
                const box=document.getElementById('set-inputs'); box.innerHTML='';
                teams.forEach((t,i)=>{
                    box.innerHTML+=`
                    <div style="display:flex; gap:5px; margin-bottom:5px;">
                        <input type="text" id="n-${i}" value="${t.name}">
                        <input type="text" id="l-${i}" value="${t.logo||''}" style="flex:1">
                        <input type="number" id="p-${i}" value="${t.basePts||0}">
                        <button onclick="delT(${i})" style="color:red">DEL</button>
                    </div>`;
                });
            });
        }
    }

    function addT(){
        db.ref('teams').once('value',snap=>{
            const list=snap.val()||[];
            list.push({
                name:'TEAM',
                logo:'https://i.ibb.co/VWVx67n/default.png',
                kills:0,
                basePts:0,
                autoPlace:0,
                alive:4,
                dead:false
            });
            db.ref('teams').set(list);
        });
    }

    function delT(i){
        db.ref('teams').once('value',snap=>{
            const list=snap.val()||[];
            list.splice(i,1);
            db.ref('teams').set(list);
            toggleM(); toggleM();
        });
    }

    function saveS(){
        db.ref('teams').once('value',snap=>{
            const list=snap.val()||[];
            list.forEach((t,i)=>{
                t.name = document.getElementById(`n-${i}`).value.toUpperCase();
                t.logo = document.getElementById(`l-${i}`).value;
                t.basePts = parseInt(document.getElementById(`p-${i}`).value)||0;
            });
            db.ref('teams').set(list);
            toggleM();
        });
    }

    /* ---------- RENDER RIGHT TABLE + FORECAST ---------- */
    function renderOverlay(teams){
        const body = document.getElementById('tableBody');
        const forecastBox = document.getElementById('forecastRows');
        body.innerHTML='';
        forecastBox.innerHTML='';

        // sort: alive first, then by basePts+kills desc
        const sorted = [...teams].sort((a,b)=>{
            if(a.dead!==b.dead) return a.dead?1:-1;
            const sa = (a.basePts||0)+(a.kills||0)*2;
            const sb = (b.basePts||0)+(b.kills||0)*2;
            return sb-sa;
        });

        sorted.forEach((t,idx)=>{
            const aliveBars = new Array(4).fill(0).map((_,i)=>`
                <div class="status-bar" style="opacity:${i < (t.alive||0) ? 1 : 0.15}"></div>
            `).join('');
            const row = document.createElement('div');
            row.className='table-row'+(t.dead?' row-dead':'');
            row.innerHTML = `
                <div class="cell">${idx+1}</div>
                <div class="cell">${(t.tag||t.name||'TEAM').substring(0,4)}</div>
                <div class="cell"><div class="status-bars">${aliveBars}</div></div>
                <div class="cell">${t.finish || ''}</div>
            `;
            body.appendChild(row);
        });

        // forecast for last 5 alive
        const aliveTeams = sorted.filter(t=>!t.dead);
        const topForForecast = aliveTeams.slice(0,5);
        let totalScore = 0;
        const scores = topForForecast.map(t=>{
            const sc = (t.basePts||0)+(t.kills||0)*2+10;
            totalScore += sc;
            return {t,sc};
        });
        scores.forEach(s=>{
            const pct = totalScore ? Math.round((s.sc/totalScore)*100) : 0;
            const row = document.createElement('div');
            row.className='forecast-row';
            row.innerHTML = `<span>${(s.t.tag||s.t.name||'TEAM').substring(0,4)}</span><span>${pct}%</span>`;
            forecastBox.appendChild(row);
        });
    }
</script>
</body>
</html>
