<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BGMI Pro Admin - Caster Indian</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        :root { --cyan: #00f2ff; }
        body { font-family: 'Oswald', sans-serif; background: #0b0e11; color: white; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .admin-panel { background: #15191d; padding: 25px; border-radius: 12px; width: 1000px; border: 1px solid #2d3439; box-shadow: 0 10px 30px rgba(0,0,0,0.5); height: 95vh; overflow-y: auto; }
        
        .theme-section { background: #1c2227; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--cyan); display: flex; align-items: center; justify-content: space-between; }
        select { background: #252c33; color: white; border: 1px solid var(--cyan); padding: 10px; border-radius: 5px; width: 70%; cursor: pointer; font-weight: bold; }

        .setting-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 25px; }
        .item { display: flex; align-items: center; justify-content: space-between; background: #252c33; padding: 8px 12px; border-radius: 6px; }
        .team-card { background: #1c2227; padding: 20px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #2d3439; position: relative; }
        
        .match-history { background: #0b0e11; padding: 10px; border-radius: 6px; display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; align-items: center; border: 1px solid #252c33; }
        .m-input { width: 45px; text-align: center; background: #1c2227; border: 1px solid var(--cyan); color: white; border-radius: 4px; padding: 5px; }
        
        .edit-grid { display: grid; grid-template-columns: 150px 1fr 70px 70px 70px; gap: 12px; margin-bottom: 15px; }
        input[type="range"] { width: 80px; accent-color: var(--cyan); }
        .action-btn { width: 100%; padding: 15px; margin-bottom: 10px; border: none; cursor: pointer; font-weight: bold; border-radius: 8px; text-transform: uppercase; transition: 0.3s; }
        label { font-size: 10px; color: #8b959e; font-weight: bold; text-transform: uppercase; }
        .p-btn { width: 40px; height: 40px; border: none; background: var(--cyan); font-weight: bold; cursor: pointer; border-radius: 6px; margin-right: 8px; }
        .p-btn.off { background: #3e474f; opacity: 0.3; }
    </style>
</head>
<body>
    <div class="admin-panel">
        <h2 style="color:var(--cyan); text-align:center; letter-spacing:3px;">PRO TOURNAMENT MANAGER</h2>
        
        <div class="theme-section">
            <label>PREMIUM THEMES:</label>
            <select onchange="applyTheme(this.value)">
                <option value="cyan">Electric Cyan (Classic)</option>
                <option value="gold">Gold & Obsidian (Premium)</option>
                <option value="crimson">Crimson Red (Aggressive)</option>
                <option value="purple">Royal Purple (Elegant)</option>
                <option value="teal">Deep Sea Teal (Clean)</option>
            </select>
        </div>

        <div class="setting-grid">
            <div class="item"><label>Logo Size</label> <input type="range" min="20" max="80" oninput="updateCfg('logo-size', this.value)"></div>
            <div class="item"><label>Name Width</label> <input type="range" min="50" max="350" oninput="updateCfg('name-width', this.value)"></div>
            <div class="item"><label>Row Height</label> <input type="range" min="25" max="70" oninput="updateCfg('row-h', this.value)"></div>
            <div class="item"><label>Col Gap</label> <input type="range" min="0" max="50" oninput="updateCfg('col-gap', this.value)"></div>
            <div class="item"><label>Total Gap</label> <input type="range" min="0" max="100" oninput="updateCfg('total-gap', this.value)"></div>
            <div class="item"><label>Custom Cyan</label> <input type="color" oninput="updateCfg('cyan', this.value)"></div>
        </div>

        <div style="display: flex; gap: 15px;">
            <button class="action-btn" style="background:#2ed573; color:white; flex:1.5;" onclick="addTeam()">+ ADD NEW TEAM</button>
            <button class="action-btn" style="background:#ffa502; color:white; flex:1;" onclick="globalAddMatch()">+ ADD MATCH COLUMN</button>
            <button class="action-btn" style="background:#ff4757; color:white; flex:1;" onclick="resetAll()">RESET ALL DATA</button>
        </div>
        <div id="team-list"></div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://bgmi-overlay-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let teams = []; let config = {};

        function sync(elimData = null) { db.ref('liveData').update({ teams, config, lastEliminated: elimData || "" }); }
        function updateCfg(p, v) { config[p] = v; sync(); }

        function applyTheme(theme) {
            const presets = {
                'cyan': { 'cyan': '#00f2ff', 'dark-blue': '#12193b', 'row-bg': '#1a2245', 'elim-bg': '#1c2227' },
                'gold': { 'cyan': '#ffd700', 'dark-blue': '#000000', 'row-bg': '#111111', 'elim-bg': '#0a0a0a' },
                'crimson': { 'cyan': '#ff3333', 'dark-blue': '#220000', 'row-bg': '#330000', 'elim-bg': '#220000' },
                'purple': { 'cyan': '#bf00ff', 'dark-blue': '#0f0f0f', 'row-bg': '#1c1c1c', 'elim-bg': '#0f0f0f' },
                'teal': { 'cyan': '#008080', 'dark-blue': '#001a1a', 'row-bg': '#002b2b', 'elim-bg': '#001a1a' }
            };
            config = {...config, ...presets[theme]};
            sync();
        }

        function globalAddMatch() { teams.forEach(t => { if(!t.matches) t.matches = []; t.matches.push(0); }); sync(); }
        function resetAll() { if(confirm("Clear everything?")){ teams.forEach(t=>{ t.fin=0; t.place=0; t.matches=[]; t.alive=[1,1,1,1]; t.elim=false; }); sync(); }}
        
        function draw() {
            const list = document.getElementById('team-list'); list.innerHTML = '';
            teams.forEach((t, i) => {
                let mPts = t.matches ? t.matches.reduce((a, b) => a + parseInt(b || 0), 0) : 0;
                let total = (parseInt(t.fin) || 0) + (parseInt(t.place) || 0) + mPts;
                list.innerHTML += `<div class="team-card">
                    <button style="position:absolute; right:15px; top:15px; background:none; border:none; color:#ff4757; font-size:20px; cursor:pointer;" onclick="removeTeam(${i})">âœ–</button>
                    <div class="edit-grid">
                        <div><label>Team Name</label><input style="width:90%" value="${t.name}" onchange="edit(${i},'name',this.value)"></div>
                        <div><label>Logo URL</label><input style="width:90%" value="${t.logo}" onchange="edit(${i},'logo',this.value)"></div>
                        <div><label>Finishes</label><input style="width:80%" type="number" value="${t.fin}" onchange="edit(${i},'fin',this.value)"></div>
                        <div><label>Placement</label><input style="width:80%" type="number" value="${t.place}" onchange="edit(${i},'place',this.value)"></div>
                        <div><label>Total</label><input style="width:80%; color:var(--cyan); font-weight:bold;" value="${total}" readonly></div>
                    </div>
                    <div style="display:flex; align-items:center; gap:20px;">
                        <div style="display:flex;">${t.alive.map((a,pi)=>`<button class="p-btn ${a?'':'off'}" onclick="tog(${i},${pi})">${pi+1}</button>`).join('')}</div>
                        <div class="match-history"><label style="color:var(--cyan); margin-right:10px;">MATCHES:</label>
                        ${(t.matches || []).map((m, mi) => `<input type="number" class="m-input" value="${m}" onchange="editMatch(${ti=i},${mi},this.value)">`).join('')}
                        </div>
                    </div>
                </div>`;
            });
        }

        function edit(i, f, v) { teams[i][f] = v; sync(); }
        function editMatch(ti, mi, v) { teams[ti].matches[mi] = v; sync(); }
        function tog(i, pi) {
            teams[i].alive[pi] = teams[i].alive[pi] ? 0 : 1;
            const aliveCount = teams[i].alive.filter(a => a === 1).length;
            let elim = null;
            if (aliveCount === 0 && !teams[i].elim) {
                teams[i].elim = true;
                elim = { name: teams[i].name, logo: teams[i].logo, finishes: (parseInt(teams[i].fin) || 0) };
            } else if (aliveCount > 0) { teams[i].elim = false; }
            sync(elim);
        }
        function addTeam() { 
            let mCount = teams.length > 0 && teams[0].matches ? teams[0].matches.length : 0;
            teams.push({ name: "TEAM", logo: "", fin: 0, place: 0, matches: new Array(mCount).fill(0), alive: [1,1,1,1], elim: false }); 
            sync(); 
        }
        function removeTeam(i) { teams.splice(i, 1); sync(); }
        db.ref('liveData').on('value', (snap) => { if(snap.exists()){ teams = snap.val().teams || []; config = snap.val().config || {}; draw(); } });
    </script>
</body>
</html>
