<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BGMI Admin - Per Match Points Fixed</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        :root { --cyan: #00f2ff; }
        body { font-family: 'Oswald', sans-serif; background: #0b0e11; color: white; padding: 20px; }
        .admin-panel { background: #15191d; padding: 25px; border-radius: 12px; max-width: 1100px; margin: auto; border: 1px solid #2d3439; }
        .control-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; background: #1c2227; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .item { display: flex; align-items: center; justify-content: space-between; background: #252c33; padding: 8px 12px; border-radius: 6px; font-size: 11px; }
        .team-card { background: #1c2227; padding: 15px; margin-bottom: 15px; border-radius: 10px; border: 1px solid #2d3439; }
        .match-list { display: flex; gap: 8px; flex-wrap: wrap; background: #0b0e11; padding: 10px; border-radius: 6px; margin-top: 10px; border: 1px solid #252c33; }
        .match-box { display: flex; flex-direction: column; align-items: center; gap: 2px; }
        .match-box label { font-size: 9px; color: var(--cyan); }
        .m-input { width: 40px; text-align: center; background: #1c2227; border: 1px solid var(--cyan); color: white; border-radius: 4px; padding: 4px; font-size: 12px; }
        input[type="range"] { width: 70px; accent-color: var(--cyan); }
        .action-btn { padding: 12px; border: none; cursor: pointer; font-weight: bold; border-radius: 6px; text-transform: uppercase; flex: 1; }
    </style>
</head>
<body>
    <div class="admin-panel">
        <h2 style="text-align:center; color:var(--cyan);">PRODUCTION MASTER - MATCH POINTS RECOVERY</h2>
        
        <div class="control-grid">
            <div class="item"><label>Theme</label> <input type="color" oninput="updateCfg('cyan', this.value)"></div>
            <div class="item"><label>Board</label> <input type="color" oninput="updateCfg('dark-blue', this.value)"></div>
            <div class="item"><label>Row</label> <input type="color" oninput="updateCfg('row-bg', this.value)"></div>
            <div class="item"><label>Logo</label> <input type="range" min="20" max="80" oninput="updateCfg('logo-size', this.value)"></div>
            <div class="item"><label>Name</label> <input type="range" min="50" max="300" oninput="updateCfg('name-width', this.value)"></div>
            <div class="item"><label>Gap</label> <input type="range" min="0" max="50" oninput="updateCfg('total-gap', this.value)"></div>
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="action-btn" style="background:#2ed573;" onclick="addTeam()">+ Add Team</button>
            <button class="action-btn" style="background:#ffa502;" onclick="globalNewMatch()">+ NEXT MATCH (SAVE & RESET)</button>
            <button class="action-btn" style="background:#ff4757;" onclick="resetAll()">Full Reset</button>
        </div>
        <div id="team-list"></div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://bgmi-overlay-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let teams = []; let config = {};

        function sync() { db.ref('liveData').update({ teams, config }); }
        function updateCfg(p, v) { config[p] = v; sync(); }

        function globalNewMatch() {
            if(confirm("Match points save karke reset karein?")){
                teams.forEach(t => {
                    let currentPts = (parseInt(t.fin)||0) + (parseInt(t.place)||0);
                    if(!t.matches) t.matches = [];
                    t.matches.push(currentPts);
                    t.fin = 0; t.place = 0; t.alive = [1,1,1,1];
                });
                sync();
            }
        }

        function draw() {
            const list = document.getElementById('team-list'); list.innerHTML = '';
            teams.forEach((t, i) => {
                let mPts = t.matches ? t.matches.reduce((a, b) => a + parseInt(b || 0), 0) : 0;
                let total = (parseInt(t.fin) || 0) + (parseInt(t.place) || 0) + mPts;
                list.innerHTML += `<div class="team-card">
                    <div style="display:grid; grid-template-columns: 1fr 1fr 60px 60px 80px; gap:10px;">
                        <input value="${t.name}" onchange="edit(${i},'name',this.value)">
                        <input value="${t.logo}" onchange="edit(${i},'logo',this.value)">
                        <input type="number" placeholder="Fin" value="${t.fin}" onchange="edit(${i},'fin',this.value)">
                        <input type="number" placeholder="Place" value="${t.place}" onchange="edit(${i},'place',this.value)">
                        <b style="color:var(--cyan)">Total: ${total}</b>
                    </div>
                    <div class="match-list">
                        ${(t.matches || []).map((m, mi) => `
                            <div class="match-box">
                                <label>M${mi+1}</label>
                                <input type="number" class="m-input" value="${m}" onchange="editMatch(${i},${mi},this.value)">
                            </div>
                        `).join('')}
                    </div>
                    <div style="margin-top:10px;">
                        ${t.alive.map((a,pi)=>`<button style="width:30px;height:30px;opacity:${a?1:0.3};background:var(--cyan);border:none;margin-right:5px;" onclick="tog(${i},${pi})">${pi+1}</button>`).join('')}
                    </div>
                </div>`;
            });
        }
        function edit(i, f, v) { teams[i][f] = v; sync(); }
        function editMatch(ti, mi, v) { teams[ti].matches[mi] = v; sync(); }
        function tog(i, pi) { teams[i].alive[pi] = teams[i].alive[pi] ? 0 : 1; sync(); }
        function addTeam() { 
            let mc = (teams.length > 0 && teams[0].matches) ? teams[0].matches.length : 0;
            teams.push({ name: "TEAM", logo: "", fin: 0, place: 0, matches: new Array(mc).fill(0), alive: [1,1,1,1] }); 
            sync(); 
        }
        function resetAll() { if(confirm("Sab delete?")){ teams=[]; sync(); }}
        db.ref('liveData').on('value', (snap) => { if(snap.exists()){ teams = snap.val().teams || []; config = snap.val().config || {}; draw(); } });
    </script>
</body>
</html>
