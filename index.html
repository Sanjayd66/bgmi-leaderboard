<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BGMI Studio v44.0 - Admin Control</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <style>
        :root { --total-bg: #00e5ff; }
        body { margin: 0; background: #111; font-family: 'Bahnschrift', sans-serif; color: white; padding-left: 330px; }
        #admin-panel { width: 310px; height: 100vh; background: #111; padding: 15px; border-right: 2px solid #333; overflow-y: auto; position: fixed; left: 0; top: 0; }
        .config-sec { background: #1a1a1a; padding: 10px; margin-bottom: 12px; border-radius: 4px; border-top: 2px solid var(--total-bg); }
        .config-sec h4 { margin: 0 0 8px 0; color: var(--total-bg); text-transform: uppercase; font-size: 10px; }
        label { display: block; margin-top: 5px; color: #888; font-size: 10px; }
        input[type="range"] { width: 100%; accent-color: var(--total-bg); }
        .btn-main { background: var(--total-bg); color: #000; width: 100%; padding: 10px; border:none; font-weight: 900; cursor: pointer; border-radius: 4px; text-transform: uppercase; margin-bottom: 10px; }
        .team-ctrl { background:#222; padding:8px; margin-bottom:5px; display:flex; gap:8px; align-items:center; border-radius: 4px; }
        input[type="number"] { background: #000; color: #fff; border: 1px solid #444; width: 40px; padding: 3px; }
    </style>
</head>
<body>

<div id="admin-panel">
    <button class="btn-main" onclick="toggleM()">‚öôÔ∏è SETUP TEAMS & BASE PTS</button>
    
    <div class="config-sec">
        <h4>üé® Design & Gap Control</h4>
        <label>Total Box Color</label><input type="color" value="#00e5ff" oninput="adj('total-bg', this.value)">
        <label>Row Gap</label><input type="range" min="0" max="20" value="2" oninput="adj('row-gap', this.value+'px')">
        <label>Elim Fade Opacity</label><input type="range" min="0" max="100" value="40" oninput="adj('fade-op', this.value/100)">
    </div>

    <div id="ctrl-list"></div>
</div>

<div id="modal" style="position:fixed; top:5%; left:340px; right: 20px; bottom: 5%; background:#111; padding:20px; border:1px solid var(--total-bg); display:none; z-index:10001; color: white; overflow-y:auto;">
    <h3>Team Data Entry (Logos & Base Points)</h3>
    <div id="set-inputs"></div>
    <button onclick="addT()" style="background:green; color:white; border:none; padding:10px; cursor:pointer;">+ ADD NEW TEAM</button>
    <button onclick="saveS()" class="btn-main" style="margin-top:20px;">SAVE TO CLOUD</button>
</div>

<script>
    // Firebase Config (Aapka URL)
    const firebaseConfig = { databaseURL: "https://live-pt-67ab3-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const posPoints = {1:10, 2:6, 3:5, 4:4, 5:3, 6:2, 7:1, 8:1};

    function adj(p, v) { db.ref('settings/' + p).set(v); }

    // Live Sync Admin List
    db.ref('teams').on('value', snap => {
        const teams = snap.val() || [];
        const ctrl = document.getElementById('ctrl-list');
        ctrl.innerHTML = '';
        teams.forEach((t, i) => {
            ctrl.innerHTML += `<div class="team-ctrl">
                <b style="flex:1; font-size:10px; overflow:hidden;">${t.name}</b>
                K:<input type="number" value="${t.kills}" onchange="db.ref('teams/${i}/kills').set(parseInt(this.value))">
                A:<input type="number" min="0" max="4" value="${t.alive}" onchange="updateAlive(${i}, this.value)">
                <input type="checkbox" ${t.dead?'checked':''} onchange="triggerElim(${i}, this.checked)">
            </div>`;
        });
    });

    function updateAlive(i, val) {
        val = parseInt(val);
        db.ref('teams/'+i+'/alive').set(val);
        if(val === 0) triggerElim(i, true);
    }

    function triggerElim(i, isChecked) {
        db.ref('teams').once('value', snap => {
            let list = snap.val();
            if(isChecked) {
                let aliveNow = list.filter(t => !t.dead).length;
                list[i].autoPlace = posPoints[aliveNow] || 0;
                list[i].dead = true;
                list[i].alive = 0;
                db.ref('lastElim').set({ name: list[i].name, logo: list[i].logo, kills: list[i].kills, rank: aliveNow, time: Date.now() });
            } else {
                list[i].dead = false;
                list[i].autoPlace = 0;
                list[i].alive = 4;
            }
            db.ref('teams').set(list);
        });
    }

    function toggleM() {
        const m = document.getElementById('modal');
        m.style.display = (m.style.display === 'block') ? 'none' : 'block';
        if(m.style.display === 'block') {
            db.ref('teams').once('value', snap => {
                const teams = snap.val() || [];
                const box = document.getElementById('set-inputs'); box.innerHTML = '';
                teams.forEach((t, i) => {
                    box.innerHTML += `<div style="display:flex; gap:5px; margin-bottom:5px;">
                        <input type="text" id="n-${i}" value="${t.name}" style="width:100px">
                        <input type="text" id="l-${i}" value="${t.logo}" style="flex:1">
                        <input type="number" id="p-${i}" value="${t.basePts}" style="width:50px">
                        <button onclick="delT(${i})" style="color:red">X</button>
                    </div>`;
                });
            });
        }
    }

    function addT() {
        db.ref('teams').once('value', snap => {
            const list = snap.val() || [];
            list.push({ name: 'TEAM', logo: 'https://i.ibb.co/VWVx67n/default.png', kills: 0, basePts: 0, autoPlace: 0, alive: 4, dead: false });
            db.ref('teams').set(list); toggleM(); toggleM();
        });
    }

    function delT(i) {
        db.ref('teams').once('value', snap => {
            const list = snap.val();
            list.splice(i, 1);
            db.ref('teams').set(list); toggleM(); toggleM();
        });
    }

    function saveS() {
        db.ref('teams').once('value', snap => {
            const list = snap.val();
            list.forEach((t, i) => {
                t.name = document.getElementById(`n-${i}`).value.toUpperCase();
                t.logo = document.getElementById(`l-${i}`).value;
                t.basePts = parseInt(document.getElementById(`p-${i}`).value) || 0;
            });
            db.ref('teams').set(list);
            document.getElementById('modal').style.display = 'none';
        });
    }
</script>
</body>
</html>
